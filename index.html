<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maximum Reality ‚Äì Night Run</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#020a2a;font-family:sans-serif;}
#controls{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:12px;z-index:10;}
button{font-size:26px;padding:12px 18px;border-radius:12px;border:none;background:#222;color:#fff;}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="controls">
  <button id="left">‚¨ÖÔ∏è</button>
  <button id="jump">‚¨ÜÔ∏è</button>
  <button id="right">‚û°Ô∏è</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* WORLD LAYOUT */
const ROAD_H = 80;
const GRASS_H = 120;
const groundY = canvas.height - ROAD_H - 18;
const treeY = canvas.height - ROAD_H - GRASS_H;

/* PLAYER */
const player = {
  x: 300,
  y: groundY,
  vy:0,
  jumping:false,
  dir:"right",
  speed:5,
  pngRight:"IMG_2161.png",
  pngLeft:"IMG_2162.png"
};
const imgRight = new Image(); imgRight.src=player.pngRight;
const imgLeft = new Image(); imgLeft.src=player.pngLeft;

/* CAMERA */
let cameraX = 0;

/* INPUT */
let left=false, right=false, jump=false;
function bind(btn,down,up){
  btn.addEventListener("touchstart",e=>{e.preventDefault(); down();});
  btn.addEventListener("touchend",e=>{e.preventDefault(); up();});
}
bind(document.getElementById("left"),()=>left=true,()=>left=false);
bind(document.getElementById("right"),()=>right=true,()=>right=false);
bind(document.getElementById("jump"),()=>jump=true,()=>jump=false);

/* SKY STARS */
const stars=[]; 
for(let i=0;i<200;i++){
  stars.push({x:Math.random()*8000,y:Math.random()*200,emoji:["‚≠êÔ∏è","‚ú®","üåü"][i%3]});
}

/* CLOUDS */
const clouds=[{x:200,y:120},{x:600,y:160},{x:1000,y:100}];

/* CITY BUILDINGS */
const buildings=[];
for(let i=0;i<10;i++){
  buildings.push({x:i*200,emoji:["üè¢","üè¨","üè≠","üè®","üè¶"][i%5],y:treeY});
}

/* TREES (background) */
const trees=[];
for(let i=0;i<50;i++){
  trees.push({x:i*150, y:treeY, emoji:"üå≤", size:80});
}

/* FARM SCENE ‚Äî aligned to green grass and horizon */
const farm=[
  {emoji:"üè†", x:4450, y: treeY + 10, width:100, height:100}, // farmhouse slightly left, horizon line
  {emoji:"üåæ", x:4420, y: treeY + 60, width:20, height:20},
  {emoji:"üåæ", x:4480, y: treeY + 65, width:20, height:20},
  {emoji:"üöú", x:4400, y: treeY + 50, width:60, height:60},
  {emoji:"üêì", x:4430, y: treeY + 90, width:20, height:20},
  {emoji:"üêì", x:4470, y: treeY + 95, width:20, height:20},
  {emoji:"üêë", x:4450, y: treeY + 85, width:30, height:30},
  {emoji:"üêñ", x:4480, y: treeY + 85, width:25, height:25},
  {emoji:"üêÑ", x:4465, y: treeY + 100, width:50, height:50, abducted:false},
  {emoji:"üêà", x:4440, y: treeY + 85, width:15, height:15}
];

/* UFO */
const ufo={x:4500,y:groundY-200,size:60,state:0}; // state=0 idle
const UFO_STATES = {IDLE:0, APPROACH:1, HOVER:2, ABDUCT:3, LEAVE:4};
ufo.state = UFO_STATES.IDLE;
ufo.sizeStart = 30;
ufo.sizeEnd = 60;
ufo.speedX = 4;
ufo.speedY = 1.5;
ufo.hoverTime = 40; // frames to hover
let abductionTimer = 0;

/* UPDATE LOOP */
function update(){
  // Player movement
  if(left){player.x-=player.speed; player.dir="left";}
  if(right){player.x+=player.speed; player.dir="right";}

  // Jump
  if(jump && !player.jumping){player.vy=-18; player.jumping=true;}
  player.vy+=1;
  player.y+=player.vy;
  if(player.y>groundY){player.y=groundY; player.vy=0; player.jumping=false;}

  // Camera follows player
  cameraX = player.x - canvas.width/2;

  // UFO Abduction
  abductionTimer++;
  const cow=farm.find(f=>f.emoji==="üêÑ");

  if(ufo.state===UFO_STATES.IDLE && abductionTimer>720 && !cow.abducted){
    ufo.state = UFO_STATES.APPROACH;
    ufo.x = cow.x - 200;
    ufo.y = cow.y - 300;
    ufo.size = ufo.sizeStart;
    abductionTimer = 0;
  }

  switch(ufo.state){
    case UFO_STATES.APPROACH:
      ufo.x += ufo.speedX;
      ufo.y += ufo.speedY;
      ufo.size += (ufo.sizeEnd-ufo.sizeStart)/50;
      if(ufo.x >= cow.x - 20){ufo.state=UFO_STATES.HOVER; ufo.hoverCounter=0;}
      break;
    case UFO_STATES.HOVER:
      ufo.hoverCounter++;
      if(ufo.hoverCounter >= ufo.hoverTime) ufo.state=UFO_STATES.ABDUCT;
      break;
    case UFO_STATES.ABDUCT:
      cow.y -= 2;
      if(cow.y <= ufo.y + 10){cow.abducted=true; ufo.state=UFO_STATES.LEAVE;}
      break;
    case UFO_STATES.LEAVE:
      ufo.x += 5;
      ufo.y -= 2;
      ufo.size -= 1;
      if(ufo.size <= 0){
        ufo.state=UFO_STATES.IDLE;
        cow.y = treeY + 100;
        cow.abducted = false;
      }
      break;
  }
}

/* DRAW LOOP */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // sky
  ctx.fillStyle="#020a2a"; ctx.fillRect(0,0,canvas.width,canvas.height);

  // stars
  ctx.font="16px sans-serif"; stars.forEach(s=>ctx.fillText(s.emoji,s.x-cameraX*0.2,s.y));

  // clouds
  ctx.font="48px sans-serif"; clouds.forEach(c=>ctx.fillText("‚òÅÔ∏è",c.x-cameraX*0.15,c.y));

  // moon
  ctx.font="60px sans-serif"; ctx.fillText("üåñ",100 - cameraX*0.05,100);

  // grass
  ctx.fillStyle="#2f7d32"; ctx.fillRect(0,treeY,canvas.width,GRASS_H);

  // road
  ctx.fillStyle="#555"; ctx.fillRect(0,groundY,canvas.width,ROAD_H);

  // trees (background)
  trees.forEach(t=>{ctx.font=t.size+"px sans-serif"; ctx.fillText(t.emoji, t.x-cameraX, t.y);});

  // buildings
  ctx.font="120px sans-serif"; buildings.forEach(b=>ctx.fillText(b.emoji, b.x-cameraX, b.y));

  // farm
  farm.forEach(f=>{ctx.font=f.height+"px sans-serif"; if(!f.abducted) ctx.fillText(f.emoji,f.x-cameraX,f.y);});

  // cow (only if not abducted)
  const cow=farm.find(f=>f.emoji==="üêÑ");
  if(!cow.abducted){ctx.font=cow.height+"px sans-serif"; ctx.fillText(cow.emoji,cow.x-cameraX,cow.y);}

  // UFO
  if(ufo.state!==UFO_STATES.IDLE){ctx.font=ufo.size+"px sans-serif"; ctx.fillText("üõ∏",ufo.x-cameraX,ufo.y);}

  // player
  const img = player.dir==="right"?imgRight:imgLeft;
  ctx.drawImage(img,player.x-cameraX-28,player.y-56,56,56);
}

/* LOOP */
function loop(){update(); draw(); requestAnimationFrame(loop);}
loop();
</script>

</body>
</html>
